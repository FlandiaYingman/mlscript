:js

:import PredefJS.mls
//│ Imported 2 member(s)


let x = 0
//│ x = 0

:sjs
let x += 1
//│ JS (unsanitized):
//│ let tmp; tmp = this.x + 1; this.x = tmp; null
//│ x = 1

x
//│ = 1

:sjs
set x = 0
//│ JS (unsanitized):
//│ this.x = 0; null

:sjs
set x += 1
//│ JS (unsanitized):
//│ let tmp; tmp = this.x + 1; this.x = tmp; null

x
//│ = 1


:sjs
set x += 1 in log(x)
//│ JS (unsanitized):
//│ let old, tmp, tmp1, tmp2;
//│ old = this.x;
//│ try {
//│   tmp1 = this.x + 1;
//│   this.x = tmp1;
//│   tmp2 = this.log(this.x);
//│   tmp = tmp2;
//│ } finally {
//│   this.x = old;
//│ }
//│ tmp
//│ > 2

x
//│ = 1


fun example() =
  let x = 0
  let get_x() = x
  let x += 1
  log(x)
  log(get_x())
example()
//│ > 1
//│ > 0

fun example() =
  let x = 0
  let get_x() = x
  set x += 1
  log(x)
  log(get_x())
example()
//│ > 1
//│ > 1

:sjs
fun example() =
  let x = 0
  let get_x() = x
  set x += 1 in log(x); log(get_x())
  log(x)
  log(get_x())
example()
//│ JS (unsanitized):
//│ function example() {
//│   let x, get_x, old, tmp, tmp1, tmp2, tmp3, tmp4, tmp5, tmp6, tmp7;
//│   x = 0;
//│   get_x = () => {
//│     return x;
//│   };
//│   old = x;
//│   try {
//│     tmp1 = x + 1;
//│     x = tmp1;
//│     tmp2 = globalThis.log(x);
//│     tmp3 = (tmp2 , globalThis.log);
//│     tmp4 = get_x() ?? null;
//│     tmp5 = tmp3(tmp4) ?? null;
//│     tmp = tmp5;
//│   } finally {
//│     x = old;
//│   }
//│   tmp6 = globalThis.log(x);
//│   tmp7 = get_x() ?? null;
//│   return globalThis.log(tmp7);
//│ }
//│ this.example()
//│ > 1
//│ > 1
//│ > 0
//│ > 0

:sjs
fun example() =
  let x = 0
  let get_x() = x
  let y =
    set x += 1 in log(x); x
  log(x)
  log(get_x())
  y
example()
//│ JS (unsanitized):
//│ function example() {
//│   let x, get_x, y, old, tmp, tmp1, tmp2, tmp3, tmp4, tmp5, tmp6;
//│   x = 0;
//│   get_x = () => {
//│     return x;
//│   };
//│   old = x;
//│   try {
//│     tmp1 = x + 1;
//│     x = tmp1;
//│     tmp2 = globalThis.log(x);
//│     tmp3 = (tmp2 , x);
//│     tmp = tmp3;
//│   } finally {
//│     x = old;
//│   }
//│   y = tmp;
//│   tmp4 = globalThis.log(x);
//│   tmp5 = get_x() ?? null;
//│   tmp6 = globalThis.log(tmp5);
//│   return y;
//│ }
//│ this.example()
//│ > 1
//│ > 0
//│ > 0
//│ = 1

