:js

:import PredefJS.mls
//│ Imported 2 member(s)


:sjs
module None
//│ JS (unsanitized):
//│ let None1;
//│ const None$class = class None {
//│   constructor() {}
//│   toString() { return "None"; }
//│ }; None1 = new None$class;
//│ None1.class = None$class;
//│ null

:sjs
None
//│ JS (unsanitized):
//│ None1
//│ = None { class: [class None] }

:sjs
:re
None()
//│ JS (unsanitized):
//│ None1() ?? null
//│ ═══[RUNTIME ERROR] TypeError: None1 is not a function

:sjs
new None
//│ JS (unsanitized):
//│ new None1.class()
//│ = None {}


:sjs
module M with
  class C
  class D()
  val x = 1
  val y = x + 1
//│ JS (unsanitized):
//│ let M1;
//│ const M$class = class M {
//│   constructor() {
//│     let tmp;
//│     this.C = class C {
//│       constructor() {}
//│       toString() { return "C"; }
//│     };
//│     this.D = function D() { return new D.class(); };
//│     this.D.class = class D {
//│       constructor() {}
//│       toString() { return "D(" +  + ")"; }
//│     };
//│     this.x = 1;
//│     tmp = this.x + 1;
//│     this.y = tmp;
//│   }
//│   toString() { return "M"; }
//│ }; M1 = new M$class;
//│ M1.class = M$class;
//│ null

M.C
//│ = [class C]

new M.C
//│ = C {}

M.D()
//│ = D {}

M.x
//│ = 1

M.y
//│ = 2

:e
:re
M.oops
//│ ╔══[ERROR] Module 'M' does not contain member 'oops'
//│ ║  l.84: 	M.oops
//│ ╙──      	 ^^^^^
//│ ═══[RUNTIME ERROR] Error: Access to required field 'oops' yielded 'undefined'


// FIXME report initialization problem or make it work
:todo
:e
:sjs
module M with
  val m: module M = M
//│ JS (unsanitized):
//│ let M3;
//│ const M$class1 = class M {
//│   constructor() {
//│     this.m = M3;
//│   }
//│   toString() { return "M"; }
//│ }; M3 = new M$class1;
//│ M3.class = M$class1;
//│ null

:re // FIXME
:sjs
M.m
//│ JS (unsanitized):
//│ M3.m
//│ ═══[RUNTIME ERROR] Error: Access to required field 'm' yielded 'undefined'



module M()


